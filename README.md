# Go-Auth

さまざまな認証方式について、実装しながら理解を深める目的で作成したリポジトリ

- Basic 認証
- Digest 認証（実装はなし）
- クッキー・セッション認証
- トークンベース認証

## JWT

JWT は以下の構成できているいる。

- Header
  - ヘッダーには署名の形式が格納されている。（アルゴリズム、タイプなど）
- Payload
  - **JWT の正式仕様（RFC 7519）**では、Payload の中の各キーと値を「Claim（主張）」と呼ぶ
  - よって、ライブラリでは`Claims`と表現されているっぽい。
- Signature
  - ヘッダーとペイロードを署名したもの
  - この Signature があるため、JWT は改ざん検知が可能
    - ヘッダーやペイロードは Base64 でエンコードされているだけであるため、誰でも中身が覗ける（そのため、セキュリティに関する情報は含めるのは NG）
    - よって、悪意のある第三者にヘッダーやペイロードが書き換えられることは可能
    - しかし、Signature は秘密鍵を持つものしか署名できない。→ よって、サーバー側で`ヘッダー+ペイロード`と`署名`を比較することで改ざん検知が可能

JWT はこれらを Base64 でエンコードし、ピリオドで区切った文字列になる。

- 例

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9. ←ヘッダー
eyJ1c2VyX2lkIjoiam9obmRvZSIsImV4cCI6MTY5NTUwNjAwMH0. ←ペイロード
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c ←署名
```

### Header

署名の形式を格納

- 例

```
{
	"alg": "HS256",
	"typ": "JWT"
}
```

### Payload

ペイロードにはログインしたユーザーの情報が格納されている

```
{
	"sub": "12345",
	"name": "John",
	"exp": 123456
}
```

ペイロードには以下のようなクレームが含まれる。
| 名前 | 概要 |
| ------------ | ------------------------------ |
| iss | トークンの発行者(認証サービス)の識別子 |
| sub | 認証したユーザーの識別子（つまり、ユーザー ID など） |
| aud | トークン受信者(サービスプロバイダー)の識別子 |
| exp | トークンの有効期限 |
| iat | トークンの発行日時 |
| jti | トークンごとの識別子 |

これら以外にもアプリケーション固有のクレームを追加することも可能

### Signature

#### 署名アルゴリズム

| アルゴリズム | 特徴                           | 主な用途                                                   |
| ------------ | ------------------------------ | ---------------------------------------------------------- |
| HS256        | 共有鍵（Secret Key）方式       | **シンプル・高速。小規模 API、内部 API 向き。**            |
| RS256        | 非対称鍵（公開鍵／秘密鍵）方式 | **OAuth2、OpenID Connect、複数サービス間認証でよく使う。** |

- HS256 の場合は、実装している通り、サーバーに秘密鍵（.env に記載している`JWT_SECRET_KEY`）を持つのみで OK
- RS256 はサーバーで秘密鍵によって署名、クライアントに公開鍵が必要
